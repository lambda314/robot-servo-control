C51 COMPILER V9.01   EEPROM                                                                11/19/2016 22:07:34 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE EEPROM
OBJECT MODULE PLACED IN eeprom.OBJ
COMPILER INVOKED BY: d:\C51\BIN\C51.EXE eeprom.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "eeprom.h"
   2          
   3          
   4          /**********************************************<+><+><+><+><+>★【robot】★<+><+><+><+><+>****************
             -********************************
   5          函数名称：i2c_init
   6          函数功能：i2c初始化
   7          输入    ：无
   8          输出    ：无
   9          ***********************************************<<<<<<<<<<<<<<<★【robot】★>>>>>>>>>>>>>>>****************
             -********************************/
  10          void i2c_init(void)
  11          {
  12   1              SDA = 1; 
  13   1              SCL = 1; 
  14   1              delay_4nop();   
  15   1      }
  16          /**********************************************<+><+><+><+><+>★【robot】★<+><+><+><+><+>****************
             -********************************
  17          函数名称：i2c_start
  18          函数功能：i2c开始信号
  19          输入    ：无
  20          输出    ：无
  21          ***********************************************<<<<<<<<<<<<<<<★【robot】★>>>>>>>>>>>>>>>****************
             -********************************/
  22          void i2c_start(void) 
  23           
  24          { 
  25   1         SDA = 1; 
  26   1         SCL = 1; 
  27   1         delay_9nop(); 
  28   1         SDA = 0; 
  29   1         delay_9nop(); 
  30   1         SCL = 0; 
  31   1      } 
  32          /**********************************************<+><+><+><+><+>★【robot】★<+><+><+><+><+>****************
             -********************************
  33          函数名称：i2c_stop
  34          函数功能：i2c停止信号
  35          输入    ：无
  36          输出    ：无
  37          ***********************************************<<<<<<<<<<<<<<<★【robot】★>>>>>>>>>>>>>>>****************
             -********************************/
  38          void i2c_stop(void) 
  39          { 
  40   1         SDA = 0; 
  41   1         SCL = 1;
  42   1         delay_9nop(); 
  43   1         SDA = 1; 
  44   1         delay_9nop(); 
  45   1         SDA = 0; 
  46   1      } 
  47          /**********************************************<+><+><+><+><+>★【robot】★<+><+><+><+><+>****************
             -********************************
  48          函数名称：read_eeprom
C51 COMPILER V9.01   EEPROM                                                                11/19/2016 22:07:34 PAGE 2   

  49          函数功能: 从AT24C0256读取数据到MCU 
  50          输入    ：无
  51          输出    : uchar read_data
  52          ***********************************************<<<<<<<<<<<<<<<★【robot】★>>>>>>>>>>>>>>>****************
             -********************************/
  53          uchar read_eeprom(void) 
  54          { 
  55   1         uchar i,read_data;                           
  56   1         for(i = 0; i < 8; i++) 
  57   1         { 
  58   2          SCL = 1; 
  59   2          read_data <<= 1; 
  60   2          read_data |= SDA; 
  61   2          SCL = 0; 
  62   2         } 
  63   1          return(read_data); 
  64   1      }
  65          /**********************************************<+><+><+><+><+>★【robot】★<+><+><+><+><+>****************
             -********************************
  66          函数名称：write_eeprom
  67          函数功能：从MCU写入数据到AT24C256 
  68          输入    ：uchar write_data
  69          输出    : bit ack_bit
  70          ***********************************************<<<<<<<<<<<<<<<★【robot】★>>>>>>>>>>>>>>>****************
             -********************************/ 
  71          bit write_eeprom(uchar write_data)   
  72          { 
  73   1         uchar i; 
  74   1         bit ack_bit; 
  75   1         for(i = 0; i < 8; i++)   // 循环移入8个位 
  76   1         { 
  77   2          SDA = (bit)(write_data & 0x80); 
  78   2          _nop_(); 
  79   2          SCL = 1; 
  80   2          delay_9nop(); 
  81   2          SCL = 0; 
  82   2          write_data <<= 1; 
  83   2         } 
  84   1         SDA = 1;                     // 读取应答 
  85   1         delay_9nop(); 
  86   1         SCL = 1; 
  87   1         delay_9nop(); 
  88   1         ack_bit = SDA; 
  89   1         SCL = 0; 
  90   1         return ack_bit;            // 返回AT24C02应答位 
  91   1      } 
  92          /**********************************************<+><+><+><+><+>★【robot】★<+><+><+><+><+>****************
             -********************************
  93          函数名称：werite_eeprom_interrupt
  94          函数功能：在中断程序中从MCU写入数据到AT24C256中
  95          输入参数：uchar k
  96          输出参数：bit ack_biti
  97          备注    : 解决keil编译器会出现重新到用该函数警告
  98          ***********************************************<<<<<<<<<<<<<<<★【robot】★>>>>>>>>>>>>>>>****************
             -********************************/
  99          bit write_eeprom_interrupt(uchar write_datai)   
 100          { 
 101   1         uchar i; 
 102   1         bit ack_biti; 
 103   1         for(i = 0; i < 8; i++)   // 循环移入8个位 
 104   1         { 
 105   2          SDA = (bit)(write_datai & 0x80); 
C51 COMPILER V9.01   EEPROM                                                                11/19/2016 22:07:34 PAGE 3   

 106   2          _nop_(); 
 107   2          SCL = 1; 
 108   2          delay_9nop(); 
 109   2          SCL = 0; 
 110   2          write_datai <<= 1; 
 111   2         } 
 112   1         SDA = 1;                     // 读取应答 
 113   1         delay_9nop(); 
 114   1         SCL = 1; 
 115   1         delay_9nop(); 
 116   1         ack_biti = SDA; 
 117   1         SCL = 0; 
 118   1         return ack_biti;            // 返回AT24C02应答位 
 119   1      } 
 120          /**********************************************<+><+><+><+><+>★【robot】★<+><+><+><+><+>****************
             -********************************
 121          函数名称：write_byte
 122          函数功能：在指定地址addr处写入数据write_data
 123          输入    ：uint addr,uchar write_data
 124          输出    ：无
 125          ***********************************************<<<<<<<<<<<<<<<★【robot】★>>>>>>>>>>>>>>>****************
             -********************************/ 
 126          void write_byte(uint addr, uchar write_data)   
 127          { 
 128   1         i2c_start(); 
 129   1         write_eeprom_interrupt(addr_write);
 130   1         write_eeprom_interrupt(addr>>8);  
 131   1         write_eeprom_interrupt(addr); 
 132   1         write_eeprom_interrupt(write_data); 
 133   1         i2c_stop(); 
 134   1         delay1ms(10);          // 写入周期 
 135   1      } 
 136          /**********************************************<+><+><+><+><+>★【robot】★<+><+><+><+><+>****************
             -********************************
 137          函数名称：write_byte1
 138          函数功能：在指定地址addr1处写入数据write_data
 139          输入    ：addr,write_data
 140          输出    ：无
 141          ***********************************************<<<<<<<<<<<<<<<★【robot】★>>>>>>>>>>>>>>>****************
             -********************************/
 142          void write_byte1(uint addr, uchar write_data)   
 143          { 
 144   1         i2c_start(); 
 145   1         write_eeprom_interrupt(addr_write1);
 146   1         write_eeprom_interrupt(addr>>8);  
 147   1         write_eeprom_interrupt(addr); 
 148   1         write_eeprom_interrupt(write_data); 
 149   1         i2c_stop(); 
 150   1         delay1ms(10);          // 写入周期 
 151   1      } 
 152          
 153          /**********************************************<+><+><+><+><+>★【robot】★<+><+><+><+><+>****************
             -********************************
 154          函数名称：read_current
 155          函数功能：在当前地址读取
 156          输入    ：无
 157          输出    ：uchar read_data
 158          ***********************************************<<<<<<<<<<<<<<<★【robot】★>>>>>>>>>>>>>>>****************
             -********************************/  
 159          uchar read_current(void)   
 160          { 
 161   1         uchar read_data; 
C51 COMPILER V9.01   EEPROM                                                                11/19/2016 22:07:34 PAGE 4   

 162   1         i2c_start(); 
 163   1         write_eeprom(addr_read); 
 164   1         read_data = read_eeprom(); 
 165   1         i2c_stop(); 
 166   1         return read_data; 
 167   1      } 
 168          /**********************************************<+><+><+><+><+>★【robot】★<+><+><+><+><+>****************
             -********************************
 169          函数名称：read_current1
 170          函数功能：在当前地址读取
 171          输入    ：无
 172          输出    ：uchar read_data
 173          ***********************************************<<<<<<<<<<<<<<<★【robot】★>>>>>>>>>>>>>>>****************
             -********************************/ 
 174          uchar read_current1(void)   
 175          { 
 176   1         uchar read_data; 
 177   1         i2c_start(); 
 178   1         write_eeprom(addr_read1); 
 179   1         read_data = read_eeprom(); 
 180   1         i2c_stop(); 
 181   1         return read_data; 
 182   1      }
 183          /**********************************************<+><+><+><+><+>★【robot】★<+><+><+><+><+>****************
             -********************************
 184          函数名称：read_random
 185          函数功能：在指定地址读取
 186          输入    ：无
 187          输出    ：uchar read_data
 188          ***********************************************<<<<<<<<<<<<<<<★【robot】★>>>>>>>>>>>>>>>****************
             -********************************/ 
 189          uchar read_random(uint random_addr)  
 190          { 
 191   1         i2c_start(); 
 192   1         write_eeprom(addr_write); 
 193   1         write_eeprom(random_addr>>8);
 194   1         write_eeprom(random_addr);
 195   1         return(read_current()); 
 196   1      } 
 197          /**********************************************<+><+><+><+><+>★【robot】★<+><+><+><+><+>****************
             -********************************
 198          函数名称：read_random1
 199          函数功能：在指定地址读取
 200          输入    ：无
 201          输出    ：uchar read_data
 202          ***********************************************<<<<<<<<<<<<<<<★【robot】★>>>>>>>>>>>>>>>****************
             -********************************/ 
 203          uchar read_random1(uint random_addr)  
 204          { 
 205   1         i2c_start(); 
 206   1         write_eeprom(addr_write1); 
 207   1         write_eeprom(random_addr>>8);
 208   1         write_eeprom(random_addr);
 209   1         return(read_current1()); 
 210   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    354    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.01   EEPROM                                                                11/19/2016 22:07:34 PAGE 5   

   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       2
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
