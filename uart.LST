C51 COMPILER V9.01   UART                                                                  11/19/2016 22:07:33 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN uart.OBJ
COMPILER INVOKED BY: d:\C51\BIN\C51.EXE uart.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "uart.h"
   2          
   3          /**********************************************<+><+><+><+><+>★【robot】★<+><+><+><+><+>****************
             -********************************
   4          函数名称：uart_init
   5          函数功能：串口1初始化
   6          输入参数：无
   7          输出参数：无
   8          ***********************************************<<<<<<<<<<<<<<<★【robot】★>>>>>>>>>>>>>>>****************
             -********************************/
   9          void uart1_init(void)
  10          {                       
  11   1              SCON  = 0x50;                           //SM0:SM1->0:1;串口1工作方式1           
  12   1              PCON |= 0x80;                           //SMOD=1;串口1工作方式1，2,3波特率加倍
  13   1              IP   |= 0x10;                           //PS=1;
  14   1              IPH  |= 0x10;                           //PS:PSH->1:1串口1为最高优先级（优先级3）
  15   1              BRT   = 0xf4;                           //9600  22118400BRT=256-Sysclk*2^SMOD/12/32/BAUD;               
  16   1              AUXR |= 0x11;                           //BRTR=1;允许独立波特率发生器运行；S1BRS=1独立波特率发生器作为串行口波特率发生器，此时定
             -时器1得到释放，可以作为独立定时器使用                 
  17   1              ES = 1;
  18   1              EA = 1;
  19   1      
  20   1      }
  21          /**********************************************<+><+><+><+><+>★【robot】★<+><+><+><+><+>****************
             -********************************
  22          函数名称：send1_char
  23          函数功能：串口1发送一字节数据
  24          输入    ：无
  25          输出    ：无
  26          ***********************************************<<<<<<<<<<<<<<<★【robot】★>>>>>>>>>>>>>>>****************
             -********************************/
  27          void send1_char(uchar txd)
  28          {
  29   1              SBUF = txd;
  30   1              while(!TI);                     
  31   1              TI = 0;         
  32   1      }
  33          /**********************************************<+><+><+><+><+>★【robot】★<+><+><+><+><+>****************
             -********************************
  34          函数名称：uart2_init
  35          函数功能：串口2初始化
  36          输入参数：无
  37          输出参数：无
  38          ***********************************************<<<<<<<<<<<<<<<★【robot】★>>>>>>>>>>>>>>>****************
             -********************************/
  39          void uart2_init(void)                   //9600bps@22.1184MHz
  40          {       
  41   1              AUXR1|= 0x10;       //S2_P4=1;UART2从P1口切换到P4口：RXD2 P1.2->4.2 TXD2 P1.3->P4.3     
  42   1              AUXR |= 0x08;           //波特率加倍
  43   1              S2CON = 0x50;           //8位数据,可变波特率
  44   1              AUXR &= 0xFB;           //独立波特率发生器时钟为Fosc/12,即12T
  45   1              IP2  |= 0x01;           //PS2=1;
  46   1              IPH2 |= 0x01;           //PS2:PS2H->1:1串口2为最高优先级（优先级3）
  47   1              BRT   = 0xF4;           //设定独立波特率发生器重装值9600bps@22.1184MHz
  48   1              AUXR |= 0x10;           //启动独立波特率发生器
C51 COMPILER V9.01   UART                                                                  11/19/2016 22:07:33 PAGE 2   

  49   1          IE2  |= 0x01;               //串行口2中断允许位
  50   1              EA    = 1;          //CPU开放总中断
  51   1      }
  52          /**********************************************<+><+><+><+><+>★【robot】★<+><+><+><+><+>****************
             -********************************
  53          函数名称：send2_char
  54          函数功能：串口2发送一字节数据
  55          输入    ：无
  56          输出    ：无
  57          ***********************************************<<<<<<<<<<<<<<<★【robot】★>>>>>>>>>>>>>>>****************
             -********************************/
  58          void send2_char(uchar txd2)
  59          {
  60   1              S2BUF = txd2;
  61   1              while(!(S2CON&S2TI));   //if uart2 S2TI=1 should end send data          
  62   1              S2CON &=~ S2TI;         //clear uart2 send data mask;(S2TI=0)           
  63   1      }
  64          /**********************************************<+><+><+><+><+>★【robot】★<+><+><+><+><+>****************
             -********************************
  65          函数名称：uart2_reinter();
  66          函数功能：串口2中断服务程序
  67          输入    ：无
  68          输出    ：无
  69          ***********************************************<<<<<<<<<<<<<<<★【robot】★>>>>>>>>>>>>>>>****************
             -********************************/
  70          
  71          void uart2_interrupt() interrupt 8 
  72          {
  73   1      uchar s2;
  74   1          if (S2CON & S2RI)
  75   1          {
  76   2              S2CON &= ~S2RI;     //Clear receive interrupt flag
  77   2                      s2=S2BUF;
  78   2                      send2_char(s2);
  79   2          }
  80   1          //if (S2CON & S2TI)
  81   1          {
  82   2              //S2CON &= ~S2TI;     //Clear transmit interrupt flag
  83   2                      //send2_char(s2);
  84   2          }
  85   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    101    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
